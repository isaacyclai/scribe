---
import Layout from "../../layouts/Layout.astro";
import SectionLabel from "../../components/SectionLabel.astro";
import PaginatedList from "../../components/islands/PaginatedList";
import { getQuestions, getQuestionCount } from "../../lib/db";
import type { ListItem } from "../../lib/types";

const PAGE_SIZE = 20;
const totalCount = getQuestionCount();
const questions = getQuestions(PAGE_SIZE, 0);

// Transform to match the ListItem interface
const initialItems: ListItem[] = questions.map((q) => ({
  id: q.id,
  title: q.sectionTitle,
  date: q.sessionDate,
  type: q.sectionType,
  category: q.category || undefined,
  ministry: q.ministry || undefined,
  speakers: q.speakers?.map((s) => s.name) || [],
  snippet: q.contentPlain?.substring(0, 150),
}));
---

<Layout
  title="Questions"
  description="Browse Singapore Parliament questions and answers"
>
  <SectionLabel>Question Time</SectionLabel>

  <h1 class="font-display text-display-lg text-ink mb-4">
    Parliamentary Questions
  </h1>

  <div
    class="font-body text-base text-ink-soft leading-relaxed max-w-[72ch] mb-8 space-y-3 text-pretty"
  >
    <p>
      Parliamentary questions (PQs) are formal inquiries made by MPs to
      Ministers. Each MP can file up to five PQs per sitting&mdash;three oral
      and two written. After the initial answer, supplementary questions may be
      asked by any MP.
    </p>
    <p>
      <strong class="text-ink">Oral questions</strong> are answered during question
      time, the first 90 minutes of each sitting. Unanswered oral questions receive
      written answers instead. <strong class="text-ink"
        >Written questions</strong
      > are answered outside of question time.
    </p>
  </div>

  <PaginatedList
    client:visible
    contentType="question"
    dataUrl="/data/questions.json"
    totalCount={totalCount}
    pageSize={PAGE_SIZE}
    placeholder="Search questions by title, speaker, or content..."
    initialItems={initialItems}
  />
</Layout>
